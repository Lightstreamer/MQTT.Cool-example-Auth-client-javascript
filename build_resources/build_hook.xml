<?xml version="1.0" encoding="UTF-8"?>
<project name="Auth_Demo_Hook" default="final_clean" basedir="..\">
  <!-- importiamo le variabili di ambiente, che vedremo come env.xxxxx -->
  <property environment="env"/>

  <!-- importiamo i task comuni a tutte le build dei progetti -->
  <import file="${env.ANT_EXTENSIONS}/scripts/projects_base.xml" />
  <property name="build" location="tmp_hook" />
  <property name="src" location="src" />
  <property name="compile_libs" location="lib" />
  <property name="dest" location="deploy" />
  <property name="dest_zip" location="${dest}/deploy.zip" />

  <target name="clean">
    <delete dir="${build}" />
    <mkdir dir="${build}" />
  </target>
  <!-- Messaggio iniziale per preparare i file coinvolti nella build -->
  <!--
  <target name="check-out" depends="getProjectSVNUrls, clean"><antcall target="initialUpdate"><param name="project_dir" value="${basedir}" /></antcall></target>
  -->
  <!--<target name="compile" depends="check-out"> -->
  <target name="compile">
    <mkdir dir="${build}" />
    <javac source="1.7" target="1.7" destdir="${build}" fork="false" deprecation="true" nowarn="on" debug="on" includeAntRuntime="false">
      <src path="${src}"/>
      <classpath>
        <fileset dir="${compile_libs}">
          <include name="ls-mqtt-hook-interface.jar"/>
        </fileset>
      </classpath>
    </javac>
  </target>

  <target name="create_jar" depends="compile">
    <jar jarfile="${dest}/lib/MQTT_Auth_demo.jar" basedir="${build}" />
  </target>

  <target name="create_zip" depends="create_jar">
    <zip destfile="${dest_zip}">
      <fileset dir="${dest}">
        <include name="README.md" />
        <include name="lib/**" />
      </fileset>
    </zip>
  </target>


  <target name="check-in" depends="create_zip">
    <antcall target="finalCommit">
      <param name="project_dir" value="${basedir}" />
      <param name="dist_dir" value="${dest}" />
      <param name="message" value="${ant.project.name}" />
    </antcall>
  </target>

  <target name="final_clean" depends="check-in">
    <delete dir="${build}" />
  </target>

</project>